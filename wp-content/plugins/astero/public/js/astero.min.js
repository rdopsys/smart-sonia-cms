/*
 * Astero WordPress Weather Plugin
 * http://archtheme.com/astero
 *
 * A WordPress plugin using openweathermap.org to display
 * current weather conditions and weather forecasts
 */
(function(f,i,j,c){var h="astero",e={current:"https://api.openweathermap.org/data/2.5/weather?",forecast:"https://api.openweathermap.org/data/2.5/onecall?",loading_class:"astero-loading",more_class:"astero-more",close_class:"astero-close",closeform_class:"astero-closeform",search_class:"astero-search",more_placeholder_class:"astero-more-placeholder",temp_class:"astero-temperature",icon_class:"astero-code",unit_class:"astero-unit",condition_class:"astero-condition",location_class:"astero-location",hi_temp_class:"astero-hi-temp",lo_temp_class:"astero-lo-temp",humidity_class:"astero-humidity-text",wind_class:"astero-wind-text",cloudiness_class:"astero-cloud-text",sunrise_class:"astero-sunrise-text",sunset_class:"astero-sunset-text",fc_hi_temp_class:"astero-fc-hi-temp",fc_lo_temp_class:"astero-fc-lo-temp",fc_icon_class:"astero-fc-icon",fc_condition_class:"astero-fc-condition",fc_cloud_class:"astero-fc-cloud",fc_humidity_class:"astero-fc-humidity",iframe_ratio:16/9,type:"geolocation"},g={appid:astero_vars.api,units:"metric",lang:"",lat:"",lon:""},b={},d={clear_d:"astero-i-sun",clear_n:"astero-i-night",clouds:"astero-i-clouds",rain:"astero-i-rain",drizzle:"astero-i-rain",thunderstorm:"astero-i-thunderstorm",fog:"astero-i-fog",mist:"astero-i-fog",haze:"astero-i-fog",snow:"astero-i-snow"},a={"200d":"P","201d":"P","202d":"0","210d":"P","211d":"P","212d":"0","221d":"P","230d":"P","231d":"P","232d":"0","200n":"6","201n":"6","202n":"&","210n":"6","211n":"6","212n":"&","221n":"6","230n":"6","231n":"6","232n":"&","300d":"Q","301d":"Q","302d":"Q","310d":"Q","311d":"Q","312d":"Q","313d":"Q","314d":"Q","321d":"Q","300n":"7","301n":"7","302n":"7","310n":"7","311n":"7","312n":"7","313n":"7","314n":"7","321n":"7","500d":"R","501d":"R","502d":"R","503d":"R","504d":"R","511d":"R","520d":"R","521d":"R","522d":"R ","531d":"R","500n":"8","501n":"8","502n":"8","503n":"8","504n":"8","511n":"8","520n":"8","521n":"8","522n":"8","531n":"8","600d":"U","601d":"U","602d":"W","611d":"X","615d":"X","616d":"X","620d":"X","621d":"W","622d":"W","600n":'"',"601n":'"',"602n":"#","611n":"$","615n":"$","616n":"$","620n":"$","621n":"#","622n":"#","701d":"J","711d":"J","721d":"J","731d":"M","741d":"M","751d":"M","761d":"M","762d":"M","771d":"M","781d":"M","701n":"K","711n":"K","721n":"K","731n":"M","741n":"M","751n":"M","761n":"M","762n":"M","771n":"M","781n":"M","800d":"B","801d":"N","802d":"N","803d":"Y","804d":"Y","800n":"2","801n":"4","802n":"5","803n":"%","804n":"%","900":"M","901":"0","902":"M","903":"G","904":"B","905":"F","906":"G","951":"B","952":"F","953":"F","954":"F","955":"F","956":"F","957":"F","958":"F","959":"F","960":"O","961":"0","962":"0"};function k(r,p,m){var s=this;this.element=r;this.$element=f(r);this.weather_options=f.extend({},g,p,m);this.forecast_options=f.extend({},this.weather_options,b);this._settings=f.extend({},e,m);this.codes=a;this._default_imgs=d;this._hasVideo=this.$element.find("video").length>0;this._hasIframe=this.$element.find(".astero-yt").length>0;this._hasImage=this.$element.hasClass("astero-img");this.$form=this.$element.find("form");this._isFull=this.$element.find(".astero-full").length>0;this.$background=this.$element.find(".astero-background");this.$large=this.$element.find(".astero-large");this._ownTranslation=false;this._startInit=false;if(this.weather_options.lang=="own"){this.weather_options.lang=="";this.forecast_options=f.extend({},s.weather_options,b);this._ownTranslation=true}if(this.weather_options.hasOwnProperty("q")&&(this.weather_options.q).length>0&&this.weather_options.q=="geolocation"){this.weather_options.q="";if(navigator.geolocation){var o=setTimeout(q,5000);navigator.geolocation.getCurrentPosition(n,q,{enableHighAccuracy:false,timeout:5000,maximumAge:0})}else{q()}}else{if(this.weather_options.hasOwnProperty("q")&&(this.weather_options.q).length>0&&this.weather_options.q=="ip"){this.weather_options.q="";q()}else{this._settings.type="location";this._startInit=true}}function n(t){clearTimeout(o);s.weather_options.lat=t.coords.latitude;s.weather_options.lon=t.coords.longitude;s.forecast_options=f.extend({},s.weather_options,b);s.init(s,"first")}function q(){clearTimeout(o);f.ajax({type:"post",url:astero_vars.ajaxurl,dataType:"json",data:{action:"astero_owm_geoip"},error:function(t,v,u){s.error()},success:function(t){if(t.success){s.weather_options=f.extend({},s.weather_options,t.success)}else{s.error()}s.forecast_options=f.extend({},s.weather_options,b);s.init(s,"first")}})}this.$element.find("."+this._settings.more_class).click(function(){s.enlarge(s)});this.$element.find("."+this._settings.close_class).click(function(){s.close(s)});this.$element.find("."+this._settings.search_class).click(function(){s.openform(s)});this.$element.find("."+this._settings.closeform_class).click(function(){s.closeform(s)});if(this._hasIframe){this.resizeVideo(s);var l;f(i).resize(function(){clearTimeout(l);l=setTimeout(function(){s.resizeVideo(s)},200)})}if(this._isFull){s.setEQ(s);var l;f(i).resize(function(){clearTimeout(l);l=setTimeout(function(){s.setEQ(s)},200)})}this.$form.submit(function(v){v.preventDefault();var w=f('input:text[name="location"]',f(this)),t=f('select[name="units"]',f(this));if(w.val().length>0){var u=new google.maps.Geocoder();if(u){u.geocode({address:w.val()},function(y,x){if(x=="OK"&&typeof(y[0].geometry.location.lat())!="undefined"&&typeof(y[0].geometry.location.lng())!="undefined"){if(y[0].formatted_address.length>0){s.weather_options.city=y[0].formatted_address}s.weather_options.lat=y[0].geometry.location.lat();s.weather_options.lon=y[0].geometry.location.lng();if(t.length>0){s.weather_options.units=t.val()=="imperial"?"imperial":"metric"}s._settings.type="search";s.loading();s._newCall=true;s.init(s)}else{s.error()}})}else{s.error()}}s.closeform(s)});if(this._startInit){this.init(s,"first")}}k.prototype={init:function(n,m){var o=(typeof(sessionStorage)==c)?(typeof(localStorage)==c)?{getItem:function(p){return this.store[p]},setItem:function(p,q){this.store[p]=q},removeItem:function(p){delete this.store[p]},clear:function(){for(var p in this.store){if(this.store.hasOwnProperty(p)){delete this.store[p]}}},store:{}}:localStorage:sessionStorage;try{o.setItem("test","1");o.removeItem("test")}catch(l){o=false}f.ajaxPrefilter(function(q,v,r){if(!o||!q.localCache){return}var u=q.cacheTTL||5;var t=q.cacheKey||q.url.replace(/jQuery.*/,"")+q.type+q.data;var p=o.getItem(t+"cachettl");if(p&&p<+new Date()){o.removeItem(t);o.removeItem(t+"cachettl");p="expired"}var s=o.getItem(t);if(!s){q.success=function(x){var w=x;if(this.dataType.indexOf("json")===0){w=JSON.stringify(x)}try{o.setItem(t,w)}catch(y){o.removeItem(t);o.removeItem(t+"cachettl");console.log("Cache Error:"+y,t,w)}};if(!p||p==="expired"){o.setItem(t+"cachettl",+new Date()+1000*60*60*u)}}});f.ajaxTransport("json",function(q){if(q.localCache){var s=q.cacheKey||q.url.replace(/jQuery.*/,"")+q.type+q.data,r;try{r=o.getItem(s)}catch(p){r=false}if(r){if(q.dataType.indexOf("json")===0){r=JSON.parse(r)}return{send:function(u,t){t(200,"success",{json:r})},abort:function(){console.log("Aborted ajax transport for json cache.")}}}}});f.when(f.ajax({url:this._settings.current+f.param(this.weather_options),type:"GET",dataType:n._msieversion()==8||n._msieversion()==9?"jsonp":"json",crossDomain:true,localCache:true,cacheTTL:1,error:function(){n.error()}}),f.ajax({url:this._settings.forecast+f.param(this.forecast_options),type:"GET",dataType:n._msieversion()==8||n._msieversion()==9?"jsonp":"json",localCache:true,cacheTTL:1,crossDomain:true,error:function(){n.error()}})).done(function(q,p){if(n._newCall!=true||m!="first"){if(q[0].cod=="200"&&p[1]=="success"){n.success(q[0],p[0],function(){if(n._hasIframe){n.resizeVideo(n)}},m)}else{n.error()}}}).fail(function(){if(n._newCall!=true||m!="first"){n.error()}})},success:function(p,l,q,m){var n=this,o=this.weather_options.units=="imperial"?"f":"c";this._loadCurrent({temp_class:Math.round(p.main.temp),icon_class:this._getCode(p.weather[0].id,p.weather[0].icon),condition_class:p.weather[0].description,location_class:function(){if(m=="first"&&n._settings.type=="location"&&typeof(n._settings.city_name)!="undefined"){return n._settings.city_name}else{if(p.sys.hasOwnProperty("country")&&(p.sys.country).length>0&&(p.name).length>0){return p.name+", "+p.sys.country}else{if((p.name).length>0){return p.name}else{if(n.weather_options.hasOwnProperty("city")&&n.weather_options.city!=""){return n.weather_options.city}}}}return""},hi_temp_class:Math.round((l.daily[0].temp.max+0.00001))*100/100,lo_temp_class:Math.round((l.daily[0].temp.min+0.00001))*100/100,humidity_class:Math.round(p.main.humidity),wind_class:this._getWind(p.wind.deg)+" "+Math.round((p.wind.speed+0.00001)*100)/100,cloudiness_class:Math.round(p.clouds.all),sunrise_class:this._getTime(p.sys.sunrise),sunset_class:this._getTime(p.sys.sunset),unit_class:this.weather_options["unit_"+o]});this._loadForecast(l.daily,{fc_hi_temp_class:"temp.max",fc_lo_temp_class:"temp.min",fc_condition_class:"weather.0.description",fc_cloud_class:"clouds",fc_humidity_class:"humidity"});this.$element.find("."+this._settings.loading_class+", ."+this._settings.more_placeholder_class).hide();this.$element.find("."+this._settings.more_class).removeClass("hide");this.$element.find("."+this._settings.icon_class).addClass("asterofont");if(this._hasImage){this.$background.removeClass(function(r,s){return(s.match(/(^|\s)astero-i-\S+/g)||[]).join(" ")}).addClass(this._getImage(p.weather[0].main,p.weather[0].icon))}if(typeof q=="function"){q.call(this)}},error:function(){this._loadCurrent({temp_class:"",icon_class:astero_vars.na,condition_class:"___",location_class:"______",hi_temp_class:"___",lo_temp_class:"___",humidity_class:"",wind_class:"",cloudiness_class:"",sunrise_class:"",sunset_class:""});this.$element.find("."+this._settings.loading_class).hide();this.$element.find("."+this._settings.more_placeholder_class).show();this.$element.find("."+this._settings.more_class).addClass("hide");this.$element.find("."+this._settings.icon_class).removeClass("asterofont")},loading:function(){this._loadCurrent({temp_class:"",icon_class:"",condition_class:"___",location_class:"______",hi_temp_class:"___",lo_temp_class:"___",humidity_class:"",wind_class:"",cloudiness_class:"",sunrise_class:"",sunset_class:"",unit_class:"&deg;"});var m={fc_hi_temp_class:"",fc_lo_temp_class:"",fc_condition_class:"",fc_cloud_class:"",fc_humidity_class:""};for(var l=0;l<this.forecast_options.cnt;l++){for(cl in m){this.$element.find("."+this._settings[cl]+l).html(m[cl])}}this.$element.find("."+this._settings.loading_class).show();this.$element.find("."+this._settings.more_placeholder_class).show();this.$element.find("."+this._settings.more_class).addClass("hide");this.$element.find("."+this._settings.icon_class).removeClass("asterofont")},enlarge:function(l){l.$element.addClass("open");l.$element.parents().css("z-index","999");if(l._hasIframe){l.resizeVideo(l)}l._disableScroll()},close:function(l){l.$element.removeClass("open");l.$element.parents().css("z-index","");if(l._hasIframe){l.resizeVideo(l)}l._enableScroll()},openform:function(l){l.$element.addClass("astero-openform")},closeform:function(l){l.$element.removeClass("astero-openform")},resizeVideo:function(p){p.$background.css("height","100%");var o=p.$element.find(".astero-yt"),n=p.$element.outerWidth(),m=parseFloat(p._settings.iframe_ratio);if(p.$element.hasClass("open")){n=p.$large.outerWidth();l=p.$large.outerHeight();p.$background.css("height",l)}else{var l=p.$element.outerHeight()}if(n/l<=m){o.css({height:l,width:l*m})}else{o.css({width:n,height:n/m})}},setEQ:function(m){var l=m.$element.outerWidth()/parseFloat(m.$element.css("font-size"));m.$large.removeClass("astero-eq-large astero-eq-small astero-eq-medium astero-eq-xsmall");if(l>=59.077){m.$large.addClass("astero-eq-large")}else{if(l<59.077&&l>=34.615){m.$large.addClass("astero-eq-medium")}else{if(l<34.615&&l>=15.385){m.$large.addClass("astero-eq-small")}else{if(l<15.385){m.$large.addClass("astero-eq-xsmall")}}}}},_disableScroll:function(){f("html").addClass("astero-open");if(f(j).height()>f(i).height()){f("html").css("top",-f(i).scrollTop()).addClass("astero-noscroll")}},_enableScroll:function(){var l=parseInt(f("html").css("top"));f("html").removeClass("astero-noscroll astero-open");f("html,body").scrollTop(-l)},_getCode:function(l,m){if(m.indexOf("n")>=0){l+="n"}else{if(m.indexOf("d")>=0){l+="d"}}return this.codes[l]},_getImage:function(l,m){var n=l.toLowerCase();if(n=="clear"){if(m.indexOf("n")>=0){n+="_n"}else{if(m.indexOf("d")>=0){n+="_d"}}}if(this._default_imgs[n]){return this._default_imgs[n]}return""},_loadCurrent:function(m){for(var l in m){this.$element.find("."+this._settings[l]).html(m[l])}},_loadForecast:function(o,q){var l=0;for(var n=1;n<7;n++){for(var p in q){var r=q[p].split("."),s=o[n];for(var m=0;m<r.length;++m){s=s[r[m]]}if(typeof s=="number"){s=Math.round(s+0.00001)*100/100}if(typeof s=="string"&&this._ownTranslation){s=astero_vars[s]}this.$element.find("."+this._settings[p]+l).html(s)}this.$element.find("."+this._settings.fc_icon_class+l).html(this._getCode(o[n].weather[0].id,o[n].weather[0].icon));l++}},_getWind:function(m){var l=[astero_vars.n,astero_vars.nne,astero_vars.ne,astero_vars.ene,astero_vars.e,astero_vars.ese,astero_vars.se,astero_vars.sse,astero_vars.s,astero_vars.ssw,astero_vars.sw,astero_vars.wsw,astero_vars.w,astero_vars.wnw,astero_vars.nw,astero_vars.nnw];return l[parseInt((m/22.5)+0.5)%16]},_getTime:function(n){var q=new Date(n*1000);var p=q.getHours(),l=("0"+q.getMinutes()).slice(-2),o=astero_vars.am;if(p>12){p=p-12;o=astero_vars.pm}else{if(p==0){p=12}}return p+":"+l+o},_msieversion:function(){var m=i.navigator.userAgent,l=m.indexOf("MSIE ");if(l>0||!!navigator.userAgent.match(/Trident.*rv\:11\./)){return(parseInt(m.substring(l+5,m.indexOf(".",l))))}return false}};f.fn[h]=function(l){return this.each(function(){if(!f.data(this,"plugin_"+h)){var m=f(this).data(h);f.data(this,"plugin_"+h,new k(this,l,m))}})};f(j).ready(function(){f(".astero-owm").astero()})})(jQuery,window,document);var playerlist=document.querySelectorAll(".astero-yt");if(playerlist.length>0){var tag=document.createElement("script");tag.src="//www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag)}function onYouTubeIframeAPIReady(){for(var a=0;a<playerlist.length;a++){var b=createPlayer(playerlist[a].getAttribute("id"),playerlist[a].getAttribute("data-videoid"))}}function createPlayer(b,a){return new YT.Player(b,{playerVars:{autoplay:1,showinfo:0,controls:0,modestbranding:1,rel:0,loop:1,div_load_policy:3,playlist:a,wmode:"transparent",origin:document.location.origin},allowfullscreen:0,videoId:a,events:{onReady:onPlayerReady}})}function onPlayerReady(a){a.target.mute();a.target.playVideo()};