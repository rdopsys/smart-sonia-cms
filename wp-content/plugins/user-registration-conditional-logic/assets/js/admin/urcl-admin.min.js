jQuery(function(u){var n={init:function(){u(document.body).on("ur_rendered_field_options ur_new_field_created",function(){n.renderConditionalLogicMapUI()}),u(document.body).on("change",".ur-enable-conditional-logic",function(){var e=u(this).is(":checked");u(".ur-selected-item.ur-item-active").find(".ur-enable-conditional-logic").attr("checked",e),e?(u("#ur-setting-form .urcl-logic-creator").slideDown(),u(".ur-selected-item.ur-item-active").find(".urcl-logic-creator").show()):(u("#ur-setting-form .urcl-logic-creator").slideUp(),u(".ur-selected-item.ur-item-active").find(".urcl-logic-creator").hide())}),u(document.body).on("click",".urcl-add-new-group",function(e){e.preventDefault();e=n.resolve_smart_tags(urcl_data.templates.group,{urcl_conditions:n.createField()});u("#ur-setting-form .urcl-logic-map-container").append(e),n.udpateRuleJSON()}),u(document.body).on("click",".urcl-add-field",function(){var e=u(this).closest(".urcl-conditional-logic__group");1===e.find(".urcl-field").length&&0===e.find(".urcl-logic-gate.is-active").length&&e.find(".urcl-logic-gate-or").addClass("is-active"),u(this).closest(".urcl-field").after(n.createField()),n.udpateRuleJSON()}),u(document.body).on("click",".urcl-remove-group",function(){var t;1<u(this).closest(".urcl-logic-map-container").find(".urcl-group").length?(t=u(this),Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to remove the Conditional Logic group? You will not be able to revert this action.",confirmButtonText:"Yeah! Go Ahead.",showCancelButton:!0}).then(function(e){e.value&&(t.closest(".urcl-group").remove(),n.udpateRuleJSON())})):Swal.fire({icon:"error",title:"Nope!",text:"You have to leave at least ONE group."})}),u(document.body).on("click",".urcl-remove-field",function(){var t,i;1<u(this).closest(".urcl-conditions-container").find(".urcl-field").length?(t=u(this),i=u(this).closest(".urcl-conditional-logic__group"),Swal.fire({icon:"warning",title:"Are you sure?",text:"Are you sure you want to remove the Conditional Logic field? You will not be able to revert this action.",confirmButtonText:"Yeah! Go Ahead.",showCancelButton:!0}).then(function(e){e.value&&(t.closest(".urcl-field").remove(),1===i.find(".urcl-field").length&&i.find(".urcl-logic-gate.is-active").length&&i.find(".urcl-logic-gate").removeClass("is-active"),n.udpateRuleJSON())})):Swal.fire({icon:"error",title:"Nope!",text:"You have to leave at least ONE field in a group."})}),u(document.body).on("change",".urcl-action-input, .urcl-root-logic-gate, .urcl-triggerer-field, .urcl-field-operator, .urcl-field-value",function(){n.udpateRuleJSON()}),u(document.body).on("change",".urcl-triggerer-field",function(){var e=u(this).val(),e=n.getInputElementForCLField(e);u(this).closest(".urcl-field").find(".urcl-field-value").remove(),u(this).closest(".urcl-field").find(".urcl-field-operator").after(e),n.udpateRuleJSON()}),u(document.body).on("click",".urcl-logic-gate",function(){u(this).is(".is-active")||(u(this).closest(".urcl-logic-gate-container").find(".urcl-logic-gate.is-active").removeClass("is-active"),u(this).addClass("is-active"),n.udpateRuleJSON())})},resolve_smart_tags:function(t,i,e){var o;return t&&i&&"object"==typeof i&&Object.keys(i).forEach(function(e){o=new RegExp("{{{"+e+"}}}","g"),t=t.replace(o,i[e])}),e&&Array.isArray(e)&&e.length&&e.forEach(function(e){e&&"object"==typeof e&&e.placeholder&&""!==e.placeholder&&(o=new RegExp("{{{"+e.placeholder+":"+e.tag+"}}}","g"),t=t.replace(o,e.value),o=new RegExp("{{{"+e.placeholder+":[A-z0-9_]+}}}","g"),t=t.replace(o,""))}),t},renderConditionalLogicMapUI:function(){var e,t,i=u("#ur-setting-form .urcl-logic-map").val(),o=null;try{i=(i=i.replace(/\\"/g,'"')).replace(/^"|"$/g,""),o=JSON.parse(i)}catch(l){}o&&(e=o.logic_map,i=u("#ur-setting-form .urcl-logic-creator"),t=[],i.find(".urcl-action-input").val(o.action),i.find(".urcl-root-logic-gate").val(e.logic_gate),e.conditions.forEach(function(e){t.push(n.createGroup(e))}),i.find(".urcl-logic-map-container").html(t.join("")))},createGroup:function(e){var t=[];return e||"object"==typeof e||(e={}),Array.isArray(e.conditions)&&e.conditions.forEach(function(e){t.push(n.createField(e))}),n.resolve_smart_tags(urcl_data.templates.group,{urcl_conditions:t.join("")},[{placeholder:"urcl_logic_gate",tag:e.logic_gate,value:"is-active"}])},createField:function(e){return e||"object"==typeof e||(e={}),n.resolve_smart_tags(urcl_data.templates.field,{urcl_triggerer_input:n.getFormFields(e.triggerer_id,[n.getSelectedFieldId()]),urcl_field_value_input:n.getInputElementForCLField(e.triggerer_id,e.value)},[{placeholder:"operator",tag:e.operator,value:"selected"}])},getSelectedFieldId:function(){return u(".ur-selected-item.ur-item-active").find(".ur-general-setting-field-name .ur-general-setting-field").val()},getFormFields:function(e,t,i){var o,l,n,r,c=['<option value="***">--- Select a field ---</option>'];return Array.isArray(t)||(t=[]),Array.isArray(i)||(i=["phone","date","timepicker","file","profile_picture","single_item","section_title","html","wysiwyg","billing_address_title","shipping_address_title"]),u(".ur-selected-item").each(function(){o=u(this).find(".ur-field").data("field-key"),l=u(this).find(".ur-general-setting-label .ur-general-setting-field").val(),n=u(this).find(".ur-general-setting-field-name .ur-general-setting-field").val(),r="",o&&l&&n&&(t.includes(n)||i.includes(o)||(e===n&&(r='selected="selected"'),c.push('<option data-type="'+o+'" data-label="'+l+'" value="'+n+'" '+r+">"+l+"</option>")))}),'<select class="urcl-conditional-logic__rule__param urcl-triggerer-field">'+c.join("")+"</select>"},getInputElementForCLField:function(i,o){var l,n,r,c,a="";return u(".ur-selected-item").each(function(){if(t=u(this).find(".ur-field").data("field-key"),l=u(this).find(".ur-general-setting-field-name .ur-general-setting-field").val(),["checkbox","multi_select2"].includes(t)&&(t="checkbox"),["radio","select","select2"].includes(t)&&(t="radio"),["country","billing_country","shipping_country"].includes(t)&&(t="country"),["privacy_policy","mailchimp","separate_shipping"].includes(t)&&(t="check_uncheck"),i===l){switch(t){case"checkbox":n=[],u(this).find(".ur-general-setting-options .ur-options-list .ur-type-checkbox-label").each(function(){r="",u(this).val()===o&&(r="selected"),n.push('<option value="'+u(this).val()+'" '+r+">"+u(this).val()+"</option>")}),a='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+n.join("")+"</select>";break;case"radio":n=[],u(this).find(".ur-general-setting-options .ur-options-list .ur-type-radio-label").each(function(){r="",u(this).val()===o&&(r="selected"),n.push('<option value="'+u(this).val()+'" '+r+">"+u(this).val()+"</option>")}),a='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+n.join("")+"</select>";break;case"country":n=[],u(this).find(".ur-settings-selected-countries option:selected").each(function(){r="",u(this).val()===o&&(r="selected"),n.push('<option value="'+u(this).val()+'" '+r+">"+u(this).html()+"</option>")}),a='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+n.join("")+"</select>";break;case"learndash_course":n=[];var e,t=u(".ur-general-setting-learndash_course .ur-general-setting-field-type select").val();"select_box"===t?u(this).find("#ur-input-type-learndash-course option").each(function(){r="",u(this).val()==o&&(r="selected=selected"),n.push('<option value="'+u(this).val()+'" '+r+">"+u(this).html()+"</option>")}):"check_box"===t&&u(this).find(".ur-input-type-learndash_course .ur-field input").each(function(){r="",e=u(this).data("value"),optionLabel=u(this).data("label"),e==o&&(r="selected=selected"),n.push('<option value="'+e+'" '+r+">"+optionLabel+"</option>")}),a='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+n.join("")+"</select>";break;case"number":c="",a='<input type="number" class="urcl-conditional-logic__rule__value urcl-field-value" '+(c=o?'value="'+o+'"':c)+" />";break;case"check_uncheck":a='<select class="urcl-conditional-logic__rule__value urcl-field-value">'+(n=['<option value="checked" '+("checked"===o?"selected":"")+">Checked</option>",'<option value="unchecked" '+("unchecked"===o?"selected":"")+">UnChecked</option>"]).join("")+"</select>";break;default:c="",a='<input type="text" class="urcl-conditional-logic__rule__value urcl-field-value" '+(c=o?'value="'+o+'"':c)+" />"}return!1}}),a},udpateRuleJSON:function(){var e,t,i,o=u("#ur-setting-form .urcl-logic-creator"),l={action:o.find(".urcl-action-input").val(),logic_map:{type:"group",logic_gate:o.find(".urcl-root-logic-gate").val(),conditions:[]}},n=[];o.find(".urcl-logic-map-container .urcl-group").each(function(){t=[],i=u(this).find(".urcl-logic-gate.is-active").data("value"),u(this).find(".urcl-field").each(function(){t.push({type:"field",triggerer_id:u(this).find(".urcl-triggerer-field").val(),operator:u(this).find(".urcl-field-operator").val(),value:u(this).find(".urcl-field-value").val()})}),n.push({type:"group",logic_gate:i||"",conditions:t})}),l.logic_map.conditions=n,e=JSON.stringify(l),u("#ur-setting-form .urcl-logic-map").val(e),u(".ur-selected-item.ur-item-active").find(".urcl-logic-map").val(e)}};function o(){var o="";return u(".ur-grid-lists .ur-selected-item .ur-general-setting").each(function(){var e,t=u(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-label label").text(),i=u(this).closest(".ur-selected-item").find(" .ur-admin-template .ur-field").data("field-key");"section_title"==i||"html"==i||"wysiwyg"==i||"billing_address_title"==i||"shipping_address_title"==i||void 0!==(e=u(this).find("[data-field='field_name']").val())&&(o+='<option value="'+e+'" data-type="'+i+'">'+t+"</option>")}),o}function e(){var e,t,i;u("#user_registration_form_setting_enable_assign_user_role_conditionally").is(":checked")?0===u(".urcl-role-container").length?(t=(e=u(urcl_data.users_roles_conditional_fields)).find(".urcl-field-conditional-field-select"),i='<option value="">-- Select --</option>'+o(),t.each(function(){var e=u(this).val();u(this).html(i),u(this).val(e),u(this).find('option[value="'+e+'"]').prop("selected",!0)}),u("#user_registration_form_setting_enable_assign_user_role_conditionally").closest(".urcl-form-settings-enable-assign-user-role").after(e)):u(".urcl-role-container").show():u(".urcl-role-container").hide()}n.init(),e(),u(document).on("change","#user_registration_form_setting_enable_assign_user_role_conditionally",function(){e()});var t=urcl_data.users_roles_conditions_data;function i(e,t){var i,o,l,n=u("option:selected",t).attr("data-type"),r=u("option:selected",t).val(),c=u(t).closest(e).find(".urcl-value").children().first(),t=c.attr("name"),e=c.attr("class");"checkbox"==n||"radio"==n||"select"==n||"country"==n||"billing_country"==n||"shipping_country"==n||"select2"==n||"multi_select2"==n?("select"==n||"select2"==n||"multi_select2"==n?i=u('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return u(this).val()}):"country"==n||"billing_country"==n||"shipping_country"==n?(u('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return u(this).val()}),u('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field option").map(function(){return u(this).text()})):i=u('.ur-selected-inputs .ur-selected-item .ur-general-setting-field-name input[value="'+r+'"]').closest(".ur-selected-item").find(".ur-field input").map(function(){return u(this).val()}),o="<option value>--select--</option>","country"==n||"billing_country"==n||"shipping_country"==n?(r=u('.ur-general-setting-field-name input[value="'+r+'"').closest(".ur-selected-item").find(".ur-advance-selected_countries select option:selected"),l=[],u(this).find(".urcl-value select").html('<option value="">--select--</option>'),r.each(function(){var e=u(this).val(),t=u(this).text();l.push('<option value="'+e+'">'+t+"</option>")}),o=l.join("")):1==i.length&&""===i[0]?o='<option value="1">'+urcl_data.checkbox_checked+"</option>":u(i).each(function(e,t){o=o+'<option value="'+t+'">'+t+"</option>"}),c.replaceWith('<select name="'+t+'" class="'+e+'">'+o+"</select>")):c.replaceWith('<input type="text" name="'+t+'" class="'+e+'">')}u(document).on("click",".urcl-role-logic-box .add",function(){condition_id=u(this).closest(".urcl-role-logic-box").attr("data-group");var e=u(this).closest(".urcl-role-logic-box").attr("data-last-key");e++;var t=u(this).closest(".urcl-or-groups").length;$output='<li class="'+(1===t?"urcl-conditional-or-group":"urcl-conditional-group")+'" data-key='+e+">",$output+='<div class="urcl-form-group">',$output+='<select class="urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields['+condition_id+"]["+e+']">',$output+='<option value="">-- Select --</option>',$output+=o(),$output+="</select></div>",$output+='<div class="urcl-operator"><select class="urcl-user-role-field" name="user_registration_form_operator['+condition_id+"]["+e+']">',$output+='<option value = "is" >is</option>',$output+='<option value = "is_not" >is not</option>',$output+='<option value = "empty"> empty </option>',$output+='<option value = "not_empty"> not empty </option>',$output+='<option value = "greater_than"> greater than </option>',$output+='<option value = "less_than"> less_than </option>',$output+="</select></div>",$output+='<div class="urcl-value"><input class="urcl-user-role-field" name = "user_registration_form_value['+condition_id+"]["+e+']" type="text" /></div>',$output+='<span class="add">',$output+="AND",$output+="</span>",$output+='<span class="remove">',$output+='<i class="dashicons dashicons-minus"></i>',$output+="</span></li>",u(this).closest(".urcl-role-logic-box").append($output),u(this).closest(".urcl-role-logic-box").attr("data-last-key",e)}),u(document).on("click",".urcl-role-logic-box .remove",function(){var e,t;u(this).parent().hasClass("urcl-conditional-group")?1<u(this).parent().parent().find(".urcl-conditional-group").length?u(this).parent().remove():0<u(this).parent().parent().parent().find(".urcl-conditional-or-group").length&&(u(this).parent().parent().next(".urcl-or-label").remove(),u(this).parent().parent().remove()):u(this).parent().hasClass("urcl-conditional-or-group")&&(1==u(this).parent().parent().find(".urcl-conditional-or-group").length?0===u(this).parent().parent().parent().find(".urcl-conditional-group").length?(e=u(this).parent().parent().prev(".urcl-or-label").length,t=u(this).parent().parent().next(".urcl-or-label").length,0===e?0<t&&(u(this).parent().parent().next(".urcl-or-label").remove(),u(this).parent().parent().remove()):(u(this).parent().parent().prev(".urcl-or-label").remove(),u(this).parent().parent().remove())):(u(this).parent().parent().prev(".urcl-or-label").remove(),u(this).parent().parent().remove()):u(this).parent().remove())}),u(document).on("click",".urcl-role-logic-wrap .urcl-remove-condition",function(){u(this).parent().remove(),1===u(".urcl-role-container").find(".urcl-role-logic-wrap").length&&u(".urcl-role-container").find(".urcl-remove-condition").remove()}),u(document).on("click",".urcl-role-container .urcl-add-new-condition",function(){1===u(".urcl-role-container").find(".urcl-role-logic-wrap").length&&u(".urcl-role-container").find(".urcl-role-logic-wrap .urcl-add-or-condition").after('<button class="urcl-remove-condition"></button>');var e=u(this).attr("data-last-conditionid");$output='<div class="urcl-role-logic-wrap" data-group ="condition_'+ ++e+'">',$output+='<div class="urcl-assign-role">',$output+='<p class="urcl-assign-label">'+urcl_data.assign+"</p>",$output+='<select class="urcl-user-role-field" name="user_registration_form_conditional_user_role[condition_'+e+']">',u.each(t.user_roles_list,function(e,t){$output+='<option value="'+e+'">'+t+"</option>"}),$output+="</select>",$output+="<p>"+urcl_data.only_if_following_matches+"</p>",$output+="</div>",$output+='<ul class="urcl-role-logic-box" data-group ="condition_'+e+'" data-last-key="1">',$output+='<li class="urcl-conditional-group" data-key="1">',$output+='<div class="urcl-form-group">',$output+='<select class="urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields[condition_'+e+'][1]">',$output+='<option value=""> -- Select --</option>',$output+=o(),$output+="</select></div>",$output+='<div class="urcl-operator"><select class="urcl-user-role-field" name="user_registration_form_operator[condition_'+e+'][1]">',$output+='<option value = "is" >is</option>',$output+='<option value = "is_not" >is not</option>',$output+='<option value = "empty"> empty </option>',$output+='<option value = "not_empty"> not empty </option>',$output+='<option value = "greater_than"> greater than </option>',$output+='<option value = "less_than"> less_than </option>',$output+="</select></div>",$output+='<div class="urcl-value"><input class="urcl-user-role-field" name="user_registration_user_registration_form_value[condition_'+e+'][1]" type="text" /></div>',$output+='<span class="add">',$output+="AND",$output+="</span>",$output+='<span class="remove">',$output+='<i class="dashicons dashicons-minus"></i>',$output+="</span></li>",$output+="</ul>",$output+='<button class="button button-secondary button-medium urcl-add-or-condition">Add OR Condition</button>',$output+='<button class="urcl-remove-condition"></button>',$output+="</div>",u(".urcl-role-conditional-container").append($output),u(this).attr("data-last-conditionid",e)}),u(document).on("click",".urcl-role-logic-wrap .urcl-add-or-condition",function(){var e=u(this).closest(".urcl-role-logic-wrap").attr("data-group"),t='<p class="urcl-or-label"> OR </p>';t+='<ul class="urcl-or-groups urcl-role-logic-box" data-group ="'+e+'" data-last-key="1">',t+='<li class="urcl-conditional-or-group" data-key="1">',t+='<div class="urcl-form-group">',t+='<select class="urcl-user-role-field urcl-field-conditional-field-select" name="user_registration_form_fields[condition_'+e+'][1]">',t+='<option value=""> -- Select --</option>',t+=o(),t+="</select></div>",t+='<div class="urcl-operator"><select class="urcl-user-role-field" name="user_registration_form_operator[condition_'+e+'][1]">',t+='<option value = "is" >is</option>',t+='<option value = "is_not" >is not</option>',t+='<option value = "empty"> empty </option>',t+='<option value = "not_empty"> not empty </option>',t+='<option value = "greater_than"> greater than </option>',t+='<option value = "less_than"> less_than </option>',t+="</select></div>",t+='<div class="urcl-value"><input class="urcl-user-role-field" name="user_registration_user_registration_form_value[condition_'+e+'][1]" type="text" /></div>',t+='<span class="add">',t+="AND",t+="</span>",t+='<span class="remove">',t+='<i class="dashicons dashicons-minus"></i>',t+="</span></li>",t+="</ul>",u(this).before(t)}),u(document).on("change",".urcl-conditional-group .urcl-field-conditional-field-select",function(){i(".urcl-conditional-group",this)}),u(document).on("change",".urcl-conditional-or-group .urcl-field-conditional-field-select",function(){i(".urcl-conditional-or-group",this)})});